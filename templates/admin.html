<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Cairo', sans-serif; background: #f4f6f9; margin:0; padding:20px; color:#333; }
h1 { text-align:center; color:#1976d2; }
.filters { display:flex; gap:15px; justify-content:center; margin-bottom:25px; flex-wrap:wrap; }
select, button {
    padding:10px 15px; border-radius:8px; border:none; font-size:16px; cursor:pointer; transition:0.3s;
}
select { background:#e0e0e0; }
select:hover { background:#d5d5d5; }
button { background:#1976d2; color:white; }
button:hover { background:#0d47a1; }
#printBtn { background:#f57c00; }
#printBtn:hover { background:#ef6c00; }
.delete-btn { background:#e53935; padding:6px 10px; font-size:14px; border:none; border-radius:5px; color:white; cursor:pointer; }
.delete-btn:hover { background:#b71c1c; }

table { width:100%; border-collapse:collapse; margin-bottom:35px; background:white; box-shadow:0 3px 8px rgba(0,0,0,0.1); border-radius:8px; overflow:hidden; }
th, td { padding:12px 15px; text-align:center; }
th { background:#1976d2; color:white; }
tr:nth-child(even) { background:#f1f1f1; }
.table-title { margin:15px 0 5px 0; font-size:18px; font-weight:bold; }

@media print {
    body * { visibility:hidden; }
    #tablesContainer, #tablesContainer * { visibility:visible; }
    #tablesContainer { position:absolute; left:0; top:0; width:100%; }
}

/* Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù */
#confirmModal {
    display:none;
    position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);
    justify-content:center; align-items:center;
}
#confirmBox {
    background:white; padding:20px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.3); text-align:center; width:300px;
}
#confirmBox button { width:100px; margin:10px; padding:8px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
#confirmBox #cancelBtn { background:#9e9e9e; color:white; }
#confirmBox #okBtn { background:#e53935; color:white; }
#confirmBox #cancelBtn:hover { background:#757575; }
#confirmBox #okBtn:hover { background:#b71c1c; }
</style>
</head>

<body>

<h1>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø©</h1>

<div class="filters">
<select id="classFilter">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
{% for c in classes %}
<option value="{{ c }}">{{ c }}</option>
{% endfor %}
</select>

<select id="groupFilter">
<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙÙˆØ¬</option>
{% for g in groups %}
<option value="{{ g }}">{{ g }}</option>
{% endfor %}
</select>

<button onclick="applyFilter()">ÙÙ„ØªØ±Ø©</button>
<button onclick="showAll()">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„</button>
<button id="printBtn" onclick="printTables()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<div id="tablesContainer">
{% for group_name, students in grouped.items() %}
<div class="table-wrapper" data-class="{{ group_name.split(' - ')[0] }}" data-group="{{ group_name.split(' - ')[1] }}">
<div class="table-title">{{ group_name }}</div>
<table>
<thead>
<tr>
<th>Ø§Ù„Ù„Ù‚Ø¨</th>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ù‚Ø³Ù…</th>
<th>Ø§Ù„ÙÙˆØ¬</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ</th>
<th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody>
{% for s in students %}
<tr>
<td>{{ s['last_name'] }}</td>
<td>{{ s['first_name'] }}</td>
<td>{{ s['class'] }}</td>
<td>{{ s['group'] }}</td>
<td>{{ s['phone'] }}</td>
<td>{{ s['note'] }}</td>
<td>
<button class="delete-btn" onclick="showConfirm({{ s['_index'] }})">ğŸ—‘ Ø­Ø°Ù</button>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
{% endfor %}
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ -->
<div id="confirmModal">
<div id="confirmBox">
<p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ</p>
<button id="cancelBtn" onclick="hideConfirm()">Ø¥Ù„ØºØ§Ø¡</button>
<button id="okBtn" onclick="deleteStudent()">ØªØ£ÙƒÙŠØ¯</button>
</div>
</div>

<script>
let deleteIndex = null;

function applyFilter() {
    const classVal = document.getElementById("classFilter").value;
    const groupVal = document.getElementById("groupFilter").value;
    document.querySelectorAll(".table-wrapper").forEach(t => {
        t.style.display =
        ((classVal === "" || t.dataset.class === classVal) &&
         (groupVal === "" || t.dataset.group === groupVal))
         ? "block" : "none";
    });
}

function showAll() {
    document.querySelectorAll(".table-wrapper").forEach(t => t.style.display="block");
    document.getElementById("classFilter").value="";
    document.getElementById("groupFilter").value="";
}

function printTables() {
    window.print();
}

function showConfirm(index) {
    deleteIndex = index;
    document.getElementById("confirmModal").style.display = "flex";
}

function hideConfirm() {
    deleteIndex = null;
    document.getElementById("confirmModal").style.display = "none";
}

function deleteStudent() {
    if (deleteIndex !== null) {
        window.location.href = "/delete/" + deleteIndex;
    }
}
</script>

</body>
</html>
