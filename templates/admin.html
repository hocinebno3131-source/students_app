<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† â€” Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Cairo', sans-serif; background:#f4f6f9; padding:20px }
h1 { text-align:center; color:#1976d2 }

button {
padding:10px 15px;
border-radius:8px;
border:none;
cursor:pointer;
background:#1976d2;
color:white;
}

.delete-btn { background:#e53935 }
.delete-btn:hover { background:#b71c1c }

table {
width:100%;
border-collapse:collapse;
background:white;
margin-bottom:30px;
}

th,td { padding:12px; text-align:center }
th { background:#1976d2; color:white }

.table-title { font-weight:bold; margin:15px 0 }

/* -------- MODAL -------- */
.modal {
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,0.4);
justify-content:center;
align-items:center;
}

.modal-box {
background:white;
padding:25px;
border-radius:12px;
width:320px;
text-align:center;
box-shadow:0 10px 25px rgba(0,0,0,.25);
animation:pop .2s ease;
}

@keyframes pop {
from { transform:scale(.8); opacity:0 }
to { transform:scale(1); opacity:1 }
}

.modal-actions {
display:flex;
gap:10px;
margin-top:20px;
}

.cancel-btn { background:#9e9e9e }
.confirm-btn { background:#e53935 }
</style>
</head>

<body>

<h1>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† â€” Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø©</h1>

<div id="tablesContainer">
{% for group_name, students in grouped.items() %}
<div class="table-title">{{ group_name }}</div>

<table>
<tr>
<th>Ø§Ù„Ù„Ù‚Ø¨</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„ÙÙˆØ¬</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th><th>Ø­Ø°Ù</th>
</tr>

{% for s in students %}
<tr id="row-{{ s['_index'] }}">
<td>{{ s['last_name'] }}</td>
<td>{{ s['first_name'] }}</td>
<td>{{ s['class'] }}</td>
<td>{{ s['group'] }}</td>
<td>{{ s['phone'] }}</td>
<td>{{ s['note'] }}</td>
<td>
<button class="delete-btn" onclick="openModal({{ s['_index'] }})">
ğŸ—‘ Ø­Ø°Ù
</button>
</td>
</tr>
{% endfor %}
</table>
{% endfor %}
</div>

<!-- Modal -->
<div id="deleteModal" class="modal">
<div class="modal-box">
<h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
<p>Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ</p>
<div class="modal-actions">
<button class="cancel-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
<button class="confirm-btn" onclick="confirmDelete()">ØªØ£ÙƒÙŠØ¯</button>
</div>
</div>
</div>

<script>
let deleteIndex = null

function openModal(i){
deleteIndex = i
document.getElementById("deleteModal").style.display="flex"
}

function closeModal(){
deleteIndex = null
document.getElementById("deleteModal").style.display="none"
}

function confirmDelete(){
fetch("/delete/"+deleteIndex,{method:"POST"})
.then(r=>r.json())
.then(d=>{
if(d.status==="ok"){
document.getElementById("row-"+deleteIndex).remove()
}
closeModal()
})
}
</script>

</body>
</html>
